{"ast":null,"code":"// client/src/components/auth/AuthGuard.tsx\nimport React,{useEffect,useState}from'react';import{Navigate}from'react-router-dom';import{useAuth}from'../../store/app_store';import{apiService}from'../../services/apiService';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function AuthGuard(_ref){let{children}=_ref;const{isAuthenticated,user,setUser,setClub}=useAuth();const[isLoading,setIsLoading]=useState(true);const[isCheckingAuth,setIsCheckingAuth]=useState(false);useEffect(()=>{const checkAuthStatus=async()=>{// ✅ Fixed: Use 'auth_token' to match your app_store.ts\nconst token=localStorage.getItem('auth_token');if(!token){setIsLoading(false);return;}if(isAuthenticated&&user){setIsLoading(false);return;}try{setIsCheckingAuth(true);const response=await apiService.getCurrentUser();// ✅ Fixed: Response is { user: any; club: any } directly, no .data wrapper\nsetUser(response.user);setClub(response.club);}catch(error){// Token is invalid, clear it\n// ✅ Fixed: Use 'auth_token' to match your app_store.ts\nlocalStorage.removeItem('auth_token');console.error('Auth check failed:',error);}finally{setIsCheckingAuth(false);setIsLoading(false);}};checkAuthStatus();},[isAuthenticated,user,setUser,setClub]);// Loading state while checking authentication\nif(isLoading||isCheckingAuth){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-4 border-blue-500 border-t-transparent mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Checking authentication...\"})]})});}// Redirect to auth page if not authenticated\nif(!isAuthenticated||!user){return/*#__PURE__*/_jsx(Navigate,{to:\"/auth\",replace:true});}// Render protected content\nreturn/*#__PURE__*/_jsx(_Fragment,{children:children});}","map":{"version":3,"names":["React","useEffect","useState","Navigate","useAuth","apiService","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","AuthGuard","_ref","children","isAuthenticated","user","setUser","setClub","isLoading","setIsLoading","isCheckingAuth","setIsCheckingAuth","checkAuthStatus","token","localStorage","getItem","response","getCurrentUser","club","error","removeItem","console","className","to","replace"],"sources":["/home/paulag/fundraisely-club/client/src/components/auth/AuthGuard.tsx"],"sourcesContent":["// client/src/components/auth/AuthGuard.tsx\nimport React, { useEffect, useState } from 'react';\nimport { Navigate } from 'react-router-dom';\nimport { useAuth } from '../../store/app_store';\nimport { apiService } from '../../services/apiService';\n\ninterface AuthGuardProps {\n  children: React.ReactNode;\n}\n\nexport default function AuthGuard({ children }: AuthGuardProps) {\n  const { isAuthenticated, user, setUser, setClub } = useAuth();\n  const [isLoading, setIsLoading] = useState(true);\n  const [isCheckingAuth, setIsCheckingAuth] = useState(false);\n\n  useEffect(() => {\n    const checkAuthStatus = async () => {\n      // ✅ Fixed: Use 'auth_token' to match your app_store.ts\n      const token = localStorage.getItem('auth_token');\n      \n      if (!token) {\n        setIsLoading(false);\n        return;\n      }\n\n      if (isAuthenticated && user) {\n        setIsLoading(false);\n        return;\n      }\n\n      try {\n        setIsCheckingAuth(true);\n        const response = await apiService.getCurrentUser();\n        \n        // ✅ Fixed: Response is { user: any; club: any } directly, no .data wrapper\n        setUser(response.user);\n        setClub(response.club);\n        \n      } catch (error) {\n        // Token is invalid, clear it\n        // ✅ Fixed: Use 'auth_token' to match your app_store.ts\n        localStorage.removeItem('auth_token');\n        console.error('Auth check failed:', error);\n      } finally {\n        setIsCheckingAuth(false);\n        setIsLoading(false);\n      }\n    };\n\n    checkAuthStatus();\n  }, [isAuthenticated, user, setUser, setClub]);\n\n  // Loading state while checking authentication\n  if (isLoading || isCheckingAuth) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-4 border-blue-500 border-t-transparent mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">Checking authentication...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Redirect to auth page if not authenticated\n  if (!isAuthenticated || !user) {\n    return <Navigate to=\"/auth\" replace />;\n  }\n\n  // Render protected content\n  return <>{children}</>;\n}"],"mappings":"AAAA;AACA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,OAASC,QAAQ,KAAQ,kBAAkB,CAC3C,OAASC,OAAO,KAAQ,uBAAuB,CAC/C,OAASC,UAAU,KAAQ,2BAA2B,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAMvD,cAAe,SAAS,CAAAC,SAASA,CAAAC,IAAA,CAA+B,IAA9B,CAAEC,QAAyB,CAAC,CAAAD,IAAA,CAC5D,KAAM,CAAEE,eAAe,CAAEC,IAAI,CAAEC,OAAO,CAAEC,OAAQ,CAAC,CAAGd,OAAO,CAAC,CAAC,CAC7D,KAAM,CAACe,SAAS,CAAEC,YAAY,CAAC,CAAGlB,QAAQ,CAAC,IAAI,CAAC,CAChD,KAAM,CAACmB,cAAc,CAAEC,iBAAiB,CAAC,CAAGpB,QAAQ,CAAC,KAAK,CAAC,CAE3DD,SAAS,CAAC,IAAM,CACd,KAAM,CAAAsB,eAAe,CAAG,KAAAA,CAAA,GAAY,CAClC;AACA,KAAM,CAAAC,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,YAAY,CAAC,CAEhD,GAAI,CAACF,KAAK,CAAE,CACVJ,YAAY,CAAC,KAAK,CAAC,CACnB,OACF,CAEA,GAAIL,eAAe,EAAIC,IAAI,CAAE,CAC3BI,YAAY,CAAC,KAAK,CAAC,CACnB,OACF,CAEA,GAAI,CACFE,iBAAiB,CAAC,IAAI,CAAC,CACvB,KAAM,CAAAK,QAAQ,CAAG,KAAM,CAAAtB,UAAU,CAACuB,cAAc,CAAC,CAAC,CAElD;AACAX,OAAO,CAACU,QAAQ,CAACX,IAAI,CAAC,CACtBE,OAAO,CAACS,QAAQ,CAACE,IAAI,CAAC,CAExB,CAAE,MAAOC,KAAK,CAAE,CACd;AACA;AACAL,YAAY,CAACM,UAAU,CAAC,YAAY,CAAC,CACrCC,OAAO,CAACF,KAAK,CAAC,oBAAoB,CAAEA,KAAK,CAAC,CAC5C,CAAC,OAAS,CACRR,iBAAiB,CAAC,KAAK,CAAC,CACxBF,YAAY,CAAC,KAAK,CAAC,CACrB,CACF,CAAC,CAEDG,eAAe,CAAC,CAAC,CACnB,CAAC,CAAE,CAACR,eAAe,CAAEC,IAAI,CAAEC,OAAO,CAAEC,OAAO,CAAC,CAAC,CAE7C;AACA,GAAIC,SAAS,EAAIE,cAAc,CAAE,CAC/B,mBACEd,IAAA,QAAK0B,SAAS,CAAC,0DAA0D,CAAAnB,QAAA,cACvEL,KAAA,QAAKwB,SAAS,CAAC,aAAa,CAAAnB,QAAA,eAC1BP,IAAA,QAAK0B,SAAS,CAAC,gGAAgG,CAAM,CAAC,cACtH1B,IAAA,MAAG0B,SAAS,CAAC,eAAe,CAAAnB,QAAA,CAAC,4BAA0B,CAAG,CAAC,EACxD,CAAC,CACH,CAAC,CAEV,CAEA;AACA,GAAI,CAACC,eAAe,EAAI,CAACC,IAAI,CAAE,CAC7B,mBAAOT,IAAA,CAACJ,QAAQ,EAAC+B,EAAE,CAAC,OAAO,CAACC,OAAO,MAAE,CAAC,CACxC,CAEA;AACA,mBAAO5B,IAAA,CAAAI,SAAA,EAAAG,QAAA,CAAGA,QAAQ,CAAG,CAAC,CACxB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}